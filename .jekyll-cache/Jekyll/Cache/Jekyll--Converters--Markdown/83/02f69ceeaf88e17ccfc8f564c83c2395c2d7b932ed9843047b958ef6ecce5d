I"è<p>â€ƒâ€ƒåœ¨ä¸»æ©Ÿä¸Šå¯«å€‹ Script åˆ©ç”¨æ’ç¨‹æ¯äº”åˆ†é˜ åˆ¤æ–· gateway 192.168.0.1 æ˜¯å¦å¯ä»¥ ping åˆ° google ä¸å¯ä»¥å°±æ› gateway 192.168.0.2 ä¸”ç™¼ä¿¡å‘ŠçŸ¥</p>

<p>ç•¶åˆ‡æ›åˆ°  192.168.0.2 å¾Œ , ä¸‹æ¬¡é 5 åˆ†é˜å†åˆ¤æ–·çœ‹çœ‹ gateway       192.168.0.1 æ˜¯å¦æ¢å¾© , æ¢å¾©å°±åˆ‡å› 192.168.0.1 ä¸”å¯„ä¿¡é€šçŸ¥ â€¦.</p>

<p>äº‚å¯«å°±ç”¨ä¸€æ¢é¾å¯«æ³• â€¦ä¸å¯«å‰¯ç¨‹å¼äº† â€¦.</p>

<hr />
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'åˆ¤æ–·æ˜¯å¦æ˜¯ Administrator æ¬Šé™ , ä¸æ˜¯Admin å°‡åˆ‡æ› ... åˆ‡æ›æ™‚å¯èƒ½æœƒå• (Y/N)
If Not WScript.Arguments.Named.Exists("elevate") Then
  CreateObject("Shell.Application").ShellExecute WScript.FullName _
    , """" &amp; WScript.ScriptFullName &amp; """ /elevate", "", "runas", 1
  WScript.Quit
End If

'å–å¾— strDefaultIPGateway 
strComputer = "."
Set objWMIService = GetObject("winmgmts:\\" &amp; strComputer &amp; "\root\cimv2")
Set colNetAdapters = objWMIService.ExecQuery("Select * from Win32_NetworkAdapterConfiguration where IPEnabled=TRUE")
For Each objNetAdapter in colNetAdapters
    If Not isNull(objNetAdapter.DefaultIPGateway) Then
    strDefaultIPGateway = Join(objNetAdapter.DefaultIPGateway, ",")
    End If 
Next

'è¨­å®šæª¢æŸ¥ hostname
 Dim hostname
 hostname = "www.google.com"

 'åˆ¤æ–· æ˜¯å¦ gateway æ˜¯å¦æ˜¯ 192.168.0.2
if strDefaultIPGateway = "192.168.0.2" Then

 ' å¦‚ gateway æ˜¯ 192.168.0.2 å°±åˆ‡æ›åˆ° 192.168.0.1
 Set WshShell3 = WScript.CreateObject("WScript.Shell")
 WshShell3.currentdirectory="c:\"
 WshShell3.Run "route change 0.0.0.0 mask 0.0.0.0 192.168.0.1", 0
 Set WshShell3 = Nothing

 ' ç”¨ gateway 192.168.0.1 ping google
 Set WshShell = WScript.CreateObject("WScript.Shell")
 Ping = WshShell.Run("ping -n 1 " &amp; hostname, 0, True)
 Select Case Ping
 
 ' ç•¶ ping åˆ° google å¯„ä¿¡é€šçŸ¥å·²åˆ‡æ›å›ä¾† gateway 192.168.0.1
 Case 0
  Set CDOMail = CreateObject("CDO.Message")
    With CDOMail
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/sendusing") =2
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "192.168.0.3"
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/smtpserverport") = 25
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/sendusername") = "echochio"
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/sendpassword") = "echochiopassord"
        .Configuration.Fields.Update
        .From = "echochio@test.com"
        .To = "echochio@test.com"
        .Subject = "Back to gateway to 192.168.0.1"
        .TextBody = "ping www.google.com.tw OK !! Back to gateway to 192.168.0.1"
        .Send
    End With
    Set CDOMail = Nothing

 ' ç•¶ ping ä¸åˆ° google åˆ‡æ›å›å»åŸæœ¬çš„ gateway 192.168.0.2
 Case 1 
  Set WshShell2 = WScript.CreateObject("WScript.Shell")
  WshShell2.currentdirectory="c:\"
  WshShell2.Run "route change 0.0.0.0 mask 0.0.0.0 192.168.0.2", 0
  Set WshShell2 = Nothing
 End Select

' å¦‚ gateway ä¸æ˜¯ 192.168.0.2 æ‰€ä»¥æ˜¯ 192.168.0.1 , ping google
Else 
 Set WshShell = WScript.CreateObject("WScript.Shell")
 Ping = WshShell.Run("ping -n 1 " &amp; hostname, 0, True)
 Select Case Ping
 
 'ç•¶ ping ä¸åˆ° google åˆ‡æ›å» 192.168.0.2 ä¸”å¯„ä¿¡é€šçŸ¥
 Case 1
  Set WshShell2 = WScript.CreateObject("WScript.Shell")
  WshShell2.currentdirectory="c:\"
  WshShell2.Run "route change 0.0.0.0 mask 0.0.0.0 192.168.0.2", 0
  Set WshShell2 = Nothing
  
  'å¯„ä¿¡é€šçŸ¥ åˆ‡æ›åˆ° 192.168.0.2 äº†
  Set CDOMail = CreateObject("CDO.Message")
    With CDOMail
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/sendusing") =2
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "192.168.0.3"
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/smtpserverport") = 25
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/sendusername") = "echochio"
        .Configuration.Fields("http://schemas.microsoft.com/cdo/configuration/sendpassword") = "echochiopassword"
        .Configuration.Fields.Update
        .From = "echochio@test.com"
        .To = "echochio@test.com"
        .Subject = "defult gateway cannot to google"
        .TextBody = "ping www.google.com.tw fail !! Change gateway to 192.168.0.2"
        .Send
    End With
    Set CDOMail = Nothing
 End Select
End If
</code></pre></div></div>

<hr />
<p>é–‹å§‹æ˜¯åˆ¤æ–·æ˜¯å¦æ˜¯ Administrator æ¬Šé™</p>

<p>å…¶ä¸­ mail server æ˜¯ 192.168.0.3 , å¸³è™Ÿ echochio å¯†ç¢¼ echochiopassword , å¯„ä¿¡åˆ° echochio@test.com</p>

<p>è¦è¨­å®šæœ€é«˜æ¬Šé™åŸ·è¡Œ</p>

<p><img src="/images/posts/1508824330-712718608_n.png" /></p>

<p>é‚„æ²’å¯«å®Œ â€¦è¦å¯« â€¦ç•¶ç¬¬äºŒæ¢gateway ä¹Ÿæ›äº† â€¦..é‚£â€¦.è¦å¦‚ä½• ? ç™¼ç°¡è¨Š â€¦.å“ˆ</p>
:ET