I"•<p>é–‹ ssh</p>

<p>æˆ‘æ˜¯æ”¹æˆ 2222 post</p>

<p>ssh é€²å…¥å¾Œ å† sudo -i åˆ° root</p>

<p>çœ‹æœ‰æ²’æœ‰ smartctl</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@NAS~# which smartctl
/bin/smartctl
root@NAS~# /bin/smartctl
smartctl 6.5 (build date Jul  6 2017) [x86_64-linux-3.10.102] (local build)
Copyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org

ERROR: smartctl requires a device name as the final command-line argument.


Use smartctl -h to get a usage summary
</code></pre></div></div>

<p>æ²’æœ‰å°±å»æ§åˆ¶å°è£</p>

<p>æƒæ HDD &amp; çœ‹ HDD èˆ‡ å– æº«åº¦</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@NAS ~# smartctl --scan
/dev/hda -d ata # /dev/hda, ATA device
/dev/sda -d scsi # /dev/sda, SCSI device
/dev/sdb -d scsi # /dev/sdb, SCSI device

root@NAS ~#  smartctl -a /dev/hda -d ata | egrep "Model|Temp"
Model Family:     NAS HDD
Device Model:     ST4XXXXXXXX
190 Airflow_Temperature_Cel                                          0x0022   067   062   045    Old_age   Always       -       33 (Min/Max 31/33)
194 Temperature_Celsius                                              0x0022   033   040   000    Old_age   Always       -       33 (0 18 0 0 0)
</code></pre></div></div>

<p>æ”¹ /etc/sudoers å°‡ admin æ”¹æˆä¸å†å•å¯†ç¢¼</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin        ALL=NOPASSWD: ALL
</code></pre></div></div>

<p>ç”±é ç«¯ ssh é€²ä¾† sudo â€¦. å°±å¯çœ‹åˆ°è³‡æ–™äº†</p>

<p>ç¶²è·¯ä¸ŠæŠ„å€‹ python</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="nn">paramiko</span>

<span class="n">hostname</span> <span class="o">=</span> <span class="s">'192.168.0.X'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">2222</span>
<span class="n">username</span> <span class="o">=</span> <span class="s">'User'</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">'user_pass'</span>
<span class="n">cmds</span> <span class="o">=</span> <span class="s">"sudo smartctl -a /dev/hda -d ata | awk ' /Serial Number:/ { printf </span><span class="se">\"</span><span class="si">%</span><span class="s">s: </span><span class="se">\"</span><span class="s">, $NF }; /Temperature_Celsius/ { print $10 }; ' | sed -e 's/[-_]//g'</span><span class="err">

</span><span class="s">if __name__ == "</span><span class="n">__main__</span><span class="s">":</span><span class="err">
</span><span class="s">    paramiko.util.log_to_file('/dev/null')</span><span class="err">
</span><span class="s">    s = paramiko.SSHClient()</span><span class="err">
</span><span class="s">    s.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><span class="err">
</span><span class="s">    s.connect(hostname, port, username, password)</span><span class="err">
</span><span class="s">    stdin, stdout, stderr = s.exec_command(cmds)</span><span class="err">
</span><span class="s">    print stdout.read()</span><span class="err">
</span><span class="s">    s.close()</span><span class="err">
</span></code></pre></div></div>

<p>åŸ·è¡Œ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#  python ssh.py
Z333F333: 33
</code></pre></div></div>

<p>å¦‚ä½•æ”¾åˆ° cacti â€¦è‡ªå·±æ”¾æŠŠ â€¦â€¦</p>

:ET