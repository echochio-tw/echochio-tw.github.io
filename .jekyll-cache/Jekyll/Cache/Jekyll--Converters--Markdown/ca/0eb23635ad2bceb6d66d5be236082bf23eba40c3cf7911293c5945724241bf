I" <p>debug php ç™¼ç¾ ä¸Šå‚³æª”æ¡ˆç•°å¸¸ â€¦..</p>

<p>å…ˆå»ºç«‹ä¸€å€‹ test.php</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"upload.php"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
æª”æ¡ˆåç¨±:<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"ä¸Šå‚³æª”æ¡ˆ"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span> 
</code></pre></div></div>

<p>PHP æª”æ¡ˆä¸Šå‚³å¾Œæœƒå…ˆæ”¾åˆ°ä¸€å€‹æš«å­˜è³‡æ–™å¤¾ï¼ˆtmpï¼‰ï¼Œä¸€èˆ¬æ˜¯æ”¾åˆ° /tmp , ç•¶ç„¶ä¹Ÿå¯åœ¨ php.ini è¨­å®š æš«å­˜è³‡æ–™å¤¾</p>

<p>upload.php å…§å®¹å¦‚ä¸‹ :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
<span class="err">ã€€</span><span class="k">echo</span> <span class="s2">"Error: "</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"error"</span><span class="p">];</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="k">echo</span> <span class="s2">"æª”æ¡ˆåç¨±: "</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span><span class="o">.</span><span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"æª”æ¡ˆé¡å‹: "</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span><span class="o">.</span><span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"æª”æ¡ˆå¤§å°: "</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"size"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="s2">" Kb&lt;br /&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"æš«å­˜åç¨±: "</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">][</span><span class="s2">"tmp_name"</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>æˆ‘æ¸¬è©¦äº†æ²’æœ‰ Error ç™¼ç”Ÿ â€¦.
ç„¶å¾Œç¨‹å¼æ”¹ç”¨ move_uploaded_file å°‡æª”æ¡ˆç§»å‹•åˆ° upload è³‡æ–™å¤¾ä¸­
ç•¶ç„¶ upload è³‡æ–™å¤¾è¦æœ‰æ¬Šé™ä¾‹å¦‚ apache å¯ write</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;?php
if ($_FILES["file"]["error"] &gt; 0){
ã€€echo "Error: " . $_FILES["file"]["error"];
}else{
ã€€echo "æª”æ¡ˆåç¨±: " . $_FILES["file"]["name"]."&lt;br/&gt;";
ã€€echo "æª”æ¡ˆé¡å‹: " . $_FILES["file"]["type"]."&lt;br/&gt;";
ã€€echo "æª”æ¡ˆå¤§å°: " . ($_FILES["file"]["size"] / 1024)." Kb&lt;br /&gt;";
ã€€echo "æš«å­˜åç¨±: " . $_FILES["file"]["tmp_name"];

ã€€move_uploaded_file($_FILES["file"]["tmp_name"],"upload/".$_FILES["file"]["name"]);
}
?&gt; 
</code></pre></div></div>

<p>æˆ‘æ¸¬è©¦äº†æ²’æœ‰ Error ç™¼ç”Ÿ â€¦.
ä½†æ˜¯ apache log æœ‰ move_uploaded_file failed to open stream: Permission denied
ä¸”æª”æ¡ˆæ²’æœ‰ä¸Šå‚³åˆ° upload æª”æ¡ˆå¤¾å…§</p>

<p>æäº†è€åŠå¤© â€¦.ç¾ç·¨èªª â€¦åœ¨æˆ‘åš p2v ä¹‹å‰æ­£å¸¸ â€¦
æƒ³äº†å¥½ä¹… â€¦åŸä¾†æ˜¯ â€¦..ä¹‹å‰äººè¨­å–®æ¬¡çš„ SElinux DISABLE</p>

<p>å•¥ â€¦â€¦..é‡é–‹æ©Ÿå¾Œå°±æœ‰å•é¡Œäº†, ä¹‹å‰è£å®Œå¾Œéƒ½æ²’é‡é–‹é â€¦â€¦.XD</p>

<p>SElinux DISABLE â€¦â€¦. å°±é€™éº¼ç°¡å–® â€¦.æäº†åŠå¤©</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># cat  /etc/sysconfig/selinux

# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled
# SELINUXTYPE= can take one of three two values:
#     targeted - Targeted processes are protected,
#     minimum - Modification of targeted policy. Only selected processes are protected.
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted
</code></pre></div></div>

<p>æˆ–è¨±ä½ è¦ºå¾—é—œé–‰ SElinux ä¸æ˜¯ä¸€å€‹å¥½æ–¹å¼ å°‡ç›®éŒ„æ”¹æˆ web å¯å­˜æª”å°±å¥½äº†å‘€ â€¦</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># chcon -t httpd_sys_rw_content_t /var/www/upload -R
</code></pre></div></div>
:ET