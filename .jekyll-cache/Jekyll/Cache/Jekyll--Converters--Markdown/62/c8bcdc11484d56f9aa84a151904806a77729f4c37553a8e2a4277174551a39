I"¹<p>ä»¥å‰ç™¼ç”Ÿ MegaRAID çš„ç¡¬ç¢Ÿæ›äº†æ²’é€šçŸ¥ mail â€¦.</p>

<p>æ”¹é€²ä¸€ä¸‹æ¯å¤©æª¢æŸ¥çœ‹ç¡¬ç¢Ÿç‹€æ³</p>

<p>è¦å®‰è£ storcli åœ¨ Esxi ä¸Š , æ”¹å¤©ä¾†å¯«</p>

<p>å¯«å€‹ python æ”¾å…¥æ’ç¨‹æ¯å¤©å®šæ™‚ ssh åˆ° Esxi å»æª¢æŸ¥</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span>
<span class="c1">#load paramiko for ssh 
</span><span class="kn">import</span> <span class="nn">sys</span><span class="p">,</span> <span class="n">paramiko</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="s">'192.168.0.X'</span>
<span class="n">username</span> <span class="o">=</span> <span class="s">'root'</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">'echochio'</span>
<span class="n">command</span> <span class="o">=</span> <span class="s">'/opt/lsi/storcli/storcli /c0/dall show all |grep 252'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">22</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">load_system_host_keys</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">WarningPolicy</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="n">datainp</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># datainp type is tuple ...
# use join tuple to a string
# replace \n to &lt;br&gt;
</span><span class="n">data</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datainp</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="s">'&lt;br&gt;'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.header</span> <span class="kn">import</span> <span class="n">Header</span>
<span class="n">smtpserver</span><span class="o">=</span><span class="s">'192.168.0.X'</span>
<span class="n">user</span><span class="o">=</span><span class="s">'echochio'</span>
<span class="n">password</span><span class="o">=</span><span class="s">'echochio'</span>
<span class="n">sender</span><span class="o">=</span><span class="s">'echochio@echochio.nctu.me'</span>
<span class="n">receiver</span><span class="o">=</span><span class="s">'echochio@echochio.nctu.me'</span>
<span class="c1">#count Onln string
</span><span class="n">info</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">"Onln"</span><span class="p">)</span>
<span class="c1"># change info to integer for check is 4 ?
</span><span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">subject</span><span class="o">=</span><span class="s">'Python mail esxi disk OK log'</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">subject</span><span class="o">=</span><span class="s">'Error !!  esxi disk !!! '</span>
<span class="n">msg</span><span class="o">=</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s">'html'</span><span class="p">,</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">msg</span><span class="p">[</span><span class="s">'Subject'</span><span class="p">]</span><span class="o">=</span><span class="n">Header</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">smtp</span><span class="o">=</span><span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">()</span>
<span class="n">smtp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">smtpserver</span><span class="p">)</span>
<span class="n">smtp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">smtp</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
<span class="n">smtp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"sent mail !!"</span><span class="p">)</span>
</code></pre></div></div>
:ET